{% set url = path('albums_show', {'slug': album.slug}) %}
<div class="col-md-4">
    <div class="card bg-light mb-3">
        <div class="card-header text-center">
            <a href="{{ url }}">
                {{ album.title }}
            </a>
            <small>par</small>
        </div>
        <div class="card-body">
            <h4 class="card-title">{{ album.albumDate | date('d-m-Y H:i:s') }}</h4>
            <p class="card-text">
                {{ album.content }}
            </p>
            <a href="{{ url }}" class="btn btn-primary">En voir plus !</a>
            {% if app.user and app.user == album.author %}
            <a href="{{ path('albums_edit', {'slug': album.slug}) }}" class="btn btn-secondary">Modifier</a>
            {% endif %}
            <a href="{{ path('album_like', {'id': album.id}) }}" class="btn btn-link js-like">
                {% if app.user and album.isLikedByUser(app.user) %}
                <i class="fas fa-heart"></i>
                {% else %}
                <i class="far fa-heart"></i>
                {% endif %}
                <span class="js-likes">{{ album.likes | length }}</span>
                <span class="js-label"> - J'aime</span>
            </a>
        </div>
    </div>
</div>
{% block javascripts %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>

    function onClickBtnLike(event) {
        event.preventDefault();
        const url = this.href;
        const spanCount = this.querySelector('span.js-likes');
        const icone = this.querySelector('i');

        axios.get(url).then(function (response) {
            spanCount.textContent = response.data.likes;

            if (icone.classList.contains('fas')) {
                icone.classList.replace('fas', 'far');
            } else {
                icone.classList.replace('far', 'fas');
            }
        }).catch(function (error) {
            if (error.response.status === 403) {
                window.alert("Vous ne pouvez pas liker un article en étant déconnecté !")
            }
        });
    }

    document.querySelectorAll('a.js-like').forEach(function (link) {
        link.addEventListener('click', onClickBtnLike);
    })

</script>
{% endblock %}